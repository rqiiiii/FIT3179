{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Rank bump chart of accident severity by state",
  "width": 900,
  "height": 500,
  "data": {
    "url": "https://gist.githubusercontent.com/rqiiiii/807b12c0a23de4f9eb4f3ccb411f8820/raw/47f82169eb38ee9a1f2d8d68b9878c7ee2dec6eb/road_accident_severity.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {"filter": "datum.Year >= 2011 && datum.Year <= 2021"},
    {
      "fold": [
        "Fatal Accidents",
        "Serious Accidents",
        "Minor Accidents",
        "Damage-Only Accidents"
      ],
      "as": ["Severity", "Count"]
    },
    {
      "window": [{"op": "rank", "as": "Rank"}],
      "sort": [{"field": "Count", "order": "descending"}],
      "groupby": ["Year", "Severity"]
    },
    {"filter": "datum.Severity == severitySelect"},
    {
      "calculate": 
      "datum.States === 'Johor' ? 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c3/Flag_map_of_Malacca.svg/1200px-Flag_map_of_Malacca.svg.png?20200919112754' : datum.States === 'Selangor' ? 'https://seekflag.com/wp-content/uploads/2022/01/Selangor-37.png' : datum.States === 'Kedah' ? 'https://seekflag.com/wp-content/uploads/2022/01/Kedah-37.png' : datum.States === 'Pulau Pinang' ? 'https://seekflag.com/wp-content/uploads/2022/01/Penang-37.png' : datum.States === 'Perak' ? 'https://seekflag.com/wp-content/uploads/2022/01/Perak-37.png' : datum.States === 'Perlis' ? 'https://seekflag.com/wp-content/uploads/2022/01/Perlis-37.png' : datum.States === 'Kelantan' ? 'https://seekflag.com/wp-content/uploads/2022/01/Kelantan-37.png' : datum.States === 'Terengganu' ? 'https://seekflag.com/wp-content/uploads/2022/01/Terengganu-37.png' : datum.States === 'Pahang' ? 'https://seekflag.com/wp-content/uploads/2022/01/Pahang-37.png' : datum.States === 'Melaka' ? 'https://seekflag.com/wp-content/uploads/2022/01/Malacca-37.png' : datum.States === 'Negeri Sembilan' ? 'https://seekflag.com/wp-content/uploads/2022/01/Negeri-Sembilan-37.png' : datum.States === 'Sabah' ? 'https://seekflag.com/wp-content/uploads/2022/01/Sabah-37.png' : datum.States === 'Sarawak' ? 'https://seekflag.com/wp-content/uploads/2022/01/Sarawak-37.png' : datum.States === 'Kuala Lumpur' ? 'https://seekflag.com/wp-content/uploads/2022/01/Kuala-Lumpur-37.png' : datum.States === 'W.P. Labuan' ? 'https://seekflag.com/wp-content/uploads/2022/01/Labuan.png' : datum.States === 'Putrajaya' ? 'https://seekflag.com/wp-content/uploads/2022/01/Putrajaya-37.png' : ''",
      "as": "flagURL"
    }

  ],
  "params": [
    {
      "name": "severitySelect",
      "value": "Fatal Accidents",
      "bind": {
        "input": "select",
        "options": [
          "Fatal Accidents",
          "Serious Accidents",
          "Minor Accidents",
          "Damage-Only Accidents"
        ],
        "name": "Select Severity: "
      }
    }
  ],
  "layer": [
  {
    "interactive": false,
    "mark": {"type": "line", "tooltip": null},
    "encoding": {
      "x": {"field": "Year", "type": "ordinal", "axis": {"labelAngle": 0, "title": "Year"}},
      "y": {"field": "Rank", "type": "quantitative", "scale": {"reverse": true}, "title": "Rank (1 = Highest)"},
      "color": {"field": "States", "type": "nominal", "legend": {"title": "State", "columns": 2}}
    }
  },
  {
    "mark": {"type": "circle", "size": 700, "color": "white", "stroke": "black", "strokeWidth": 2, "tooltip": null, "interactive": false},
    "encoding": {
      "x": {"field": "Year", "type": "ordinal"},
      "y": {"field": "Rank", "type": "quantitative", "scale": {"reverse": true}}
    }
  },
  {
    "mark": {"type": "image", "width": 60, "height": 60},
    "encoding": {
      "x": {"field": "Year", "type": "ordinal"},
      "y": {"field": "Rank", "type": "quantitative", "scale": {"reverse": true, "domain": [0, 15]}, "title": "Rank (1 = Highest)"},
      "url": {"field": "flagURL", "type": "nominal"},
      "tooltip": [
        {"field": "States"},
        {"field": "Year"},
        {"field": "Rank"},
        {"field": "Count"}
      ]
    }
  }
],
"resolve": {
  "tooltip": "independent"
},
  "title": {
    "text": "State Ranking by Accident Severity (2011â€“2021)",
    "fontSize": 18,
    "anchor": "start"
  }
}
