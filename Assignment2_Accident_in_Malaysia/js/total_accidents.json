{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 950,
  "height": 500,
  "background": "#ffffff", 
  "autosize": {"type": "fit"},

  "params": [
    {
      "name": "selected_year",
      "value": 2021,
      "bind": {
        "input": "range",
        "min": 2011,
        "max": 2021,
        "step": 1,
        "name": "Select Year: "
      }

    }
  ],

  "projection": {
    "type": "mercator",
    "center": [110, 4],
    "scale": 2400
  },

  "layer": [
    {
      "data": {
        "graticule": {"step": [5, 5]}
      },
      "mark": {
        "type": "geoshape",
        "stroke": "#b0bec5",
        "strokeWidth": 0.6
      }
    },
    {
      "data": {
        "url": "https://gist.githubusercontent.com/rqiiiii/a8e4dd9a63709834a4518d1d0b882f91/raw/f9944f7f27e516d29600f73db78ca30ff590d209/malaysia_map.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
      },
      "mark": {"type": "geoshape", "fill": "#f5f5f5", "stroke": "white"}
    },
    {
            "data": {
              "url": "data/malaysia_accidents.csv",
              "format": {"type": "csv"}
            },
          "transform": [
            {"filter": "datum.Year == selected_year"},
    {
      "lookup": "States",
      "from": {
        "data": {
          "url": "https://gist.githubusercontent.com/rqiiiii/a8e4dd9a63709834a4518d1d0b882f91/raw/f9944f7f27e516d29600f73db78ca30ff590d209/malaysia_map.topojson",
          "format": {"type": "topojson", "feature": "gadm41_MYS_1"}
        },
        "key": "properties.NAME_1"
      },
      "as": "geo"
    },
    {"calculate": "toNumber(datum['Accident Rate'])", "as": "AccidentRateNum"}
  ]
      ,
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.8},
      "encoding": {
        "shape": {"field": "geo", "type": "geojson"},
        "color": {
          "field": "Accident Rate",
          "type": "quantitative",
          "scale": {
            "type": "threshold",
            "domain": [10, 25, 40],
            "range": ["#fc9272", "#fb6a4a", "#cb181d","#730e11"]
            },
          "legend": {
            "title": "Accident per 1,000 population",
            "orient": "bottom",
            "direction": "horizontal"
          }
        },
        "tooltip": [
          {"field": "States", "type": "nominal", "title": "State :"},
          {"field": "Year", "type": "ordinal", "title": "Year :"},
          {"field": "Total Accidents", "type": "quantitative", "title": "Number of Accidents :"},
          {"field": "Accident Rate", "type": "quantitative","title": "Accident Rate :", "format": ".2f"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "fontSize": 24,
        "fontWeight": "bold",
        "font": "Poppins",
        "fill": "#4b0082"
      },
      "encoding": {
        "text": {"signal": "selected_year"},
        "x": {"signal": "width / 2"},
        "y": {"value": 40}
      }
    },
    {
      "data": {"values": [{}]}, 
      "transform": [{"filter": "selected_year == 2021"}],
      "mark": {
        "type": "text",
        "text": "⚠️In 2021, road accident had dropped due to COVID-19 Lockdown",
        "fontSize": 14,
        "fontWeight": "bold",
        "font": "Poppins",
        "fill": "#cd1111",
        "align": "left"
      },
      "encoding": {
        "x": {"value": 10},
        "y": {"value": 30}
      }
    },
    {
      "data": {
        "values": [
          {"States": "Johor", "longitude": 104.5, "latitude": 2.0},
          {"States": "Kedah", "longitude": 101.6, "latitude": 6.3},
          {"States": "Kelantan", "longitude": 103, "latitude": 6},
          {"States": "Malacca", "longitude": 101.1, "latitude": 2.5},
          {"States": "Negeri Sembilan", "longitude": 101.1, "latitude": 2.2},
          {"States": "Pahang", "longitude": 103.9, "latitude": 3.4},
          {"States": "Penang", "longitude": 99.7, "latitude": 5.4},
          {"States": "Perak", "longitude": 100.2, "latitude": 4.7},
          {"States": "Perlis", "longitude": 99.7, "latitude": 6.6},
          {"States": "Sabah", "longitude": 115.3, "latitude": 5.9},
          {"States": "Sarawak", "longitude": 116.1, "latitude": 2.5},
          {"States": "Selangor", "longitude": 100.4, "latitude": 3.6},
          {"States": "Terengganu", "longitude": 104, "latitude": 5.1},
          {"States": "Kuala Lumpur", "longitude": 100.4, "latitude": 3.15}
        ]
      },
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "middle",
        "fontSize": 11,
        "fill": "#000"
      },
      "encoding": {
        "longitude": {"field": "longitude"},
        "latitude": {"field": "latitude"},
        "text": {"field": "States"}
      }
    }


  ]
}
