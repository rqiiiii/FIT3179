{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1500,
  "height": 600,
  "background": "#ffffff", 
  "autosize": {"type": "fit"},

  "params": [
    {
      "name": "selected_year",
      "value": 2021,
      "bind": {
        "input": "range",
        "min": 2011,
        "max": 2021,
        "step": 1,
        "name": "Select Year: "
      }

    }
  ],

  "projection": {
    "type": "mercator",
    "center": [110, 4],
    "scale": 2400
  },

  "layer": [
    {
      "data": {
        "graticule": {"step": [5, 5]}
      },
      "mark": {
        "type": "geoshape",
        "stroke": "#b0bec5",
        "strokeWidth": 0.6
      }
    },
    {
      "data": {
        "url": "https://gist.githubusercontent.com/rqiiiii/a8e4dd9a63709834a4518d1d0b882f91/raw/f9944f7f27e516d29600f73db78ca30ff590d209/malaysia_map.topojson",
        "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
      },
      "mark": {"type": "geoshape", "fill": "#f5f5f5", "stroke": "white"}
    },
    {
            "data": {
              "url": "https://gist.githubusercontent.com/rqiiiii/19c51658dd8e38204c47e0978d922209/raw/28ad48dca7f48d83cc39ca0ccd1900347b2c5930/malaysia_accidents.csv",
              "format": {"type": "csv"}
            },
          "transform": [
            {"filter": "datum.Year == selected_year"},
    {
      "lookup": "States",
      "from": {
        "data": {
          "url": "https://gist.githubusercontent.com/rqiiiii/a8e4dd9a63709834a4518d1d0b882f91/raw/f9944f7f27e516d29600f73db78ca30ff590d209/malaysia_map.topojson",
          "format": {"type": "topojson", "feature": "gadm41_MYS_1"}
        },
        "key": "properties.NAME_1"
      },
      "as": "geo"
    },
    {"calculate": "toNumber(datum['Accident Rate'])", "as": "AccidentRateNum"}
  ]
      ,
      "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.8},
      "encoding": {
        "shape": {"field": "geo", "type": "geojson"},
        "color": {
          "field": "Accident Rate",
          "type": "quantitative",
          "scale": {
            "type": "threshold",
            "domain": [10, 20, 30],
            "range": ["#fcbba1", "#fc9272", "#fb6a4a", "#cb181d"]
            },
          "legend": {
            "orient": "bottom",
            "offset": 8,
            "direction": "horizontal",
            "columns": 4,
            "titleAnchor": "middle",
            "title": "Accident per 1,000 population",
            "titleFontSize": 14,
            "labelFontSize": 11,
            "gradientLength": 300
          }
        },
        "tooltip": [
          {"field": "States", "type": "nominal", "title": "State"},
          {"field": "Year", "type": "ordinal"},
          {"field": "Total Accidents", "type": "quantitative"},
          {"field": "Accident Rate", "type": "quantitative", "format": ".2f"}
        ]
      }
    },
    {
      "mark": {
        "type": "text",
        "align": "center",
        "fontSize": 24,
        "fontWeight": "bold",
        "font": "Poppins",
        "fill": "#4b0082"
      },
      "encoding": {
        "text": {"signal": "selected_year"},
        "x": {"signal": "width / 2"},
        "y": {"value": 40}
      }
    },
    {
      "data": {"values": [{}]}, 
      "transform": [{"filter": "selected_year == 2021"}],
      "mark": {
        "type": "text",
        "text": "⚠️In 2021, road accident had dropped due to COVID-19 Lockdown",
        "fontSize": 14,
        "fontWeight": "bold",
        "font": "Poppins",
        "fill": "#cd1111",
        "align": "left"
      },
      "encoding": {
        "x": {"value": 10},
        "y": {"value": 30}
      }
    }
  ]
}
